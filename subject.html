<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë‚˜ë¦¬ì‚¬ ì¼€ì´í¬ ì‚¬ê±´ - ì˜ì–´ ë…í•´ ë°©íƒˆì¶œ ê²Œì„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .stage-indicator {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-top: 10px;
            font-weight: 600;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin: 20px 0 0 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: white;
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .content {
            padding: 40px;
        }
        
        .stage {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .stage.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .story-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #ff6b6b;
        }
        
        .english-text {
            background: #e8f5e8;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
            font-family: 'Georgia', serif;
            line-height: 1.8;
        }
        
        .witness-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .witness-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        .witness-name {
            font-weight: 700;
            color: #495057;
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .witness-role {
            color: #6c757d;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .question-section {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .question {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .question-number {
            background: #1976d2;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-right: 10px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .answer-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40,167,69,0.3);
        }
        
        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
        }
        
        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .vocabulary {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .vocabulary h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .vocab-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .vocab-word {
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #495057;
            border: 1px solid #ffeaa7;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .vocab-word:hover {
            background: #ffeaa7;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .highlighted {
            background-color: #ffeb3b !important;
            padding: 2px 4px;
            border-radius: 3px;
            animation: highlight-pulse 1s ease-in-out;
        }
        
        @keyframes highlight-pulse {
            0% { background-color: #ffeb3b; }
            50% { background-color: #ffc107; }
            100% { background-color: #ffeb3b; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .final-stage {
            text-align: center;
            padding: 40px 20px;
        }
        
        .final-stage h2 {
            color: #28a745;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        
        .celebration {
            font-size: 3em;
            margin: 20px 0;
        }
        
        .score-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .questions-container {
            display: grid;
            gap: 20px;
        }
        
        .suspects-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .suspect-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .suspect-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #007bff;
        }
        
        .suspect-card.selected {
            border-color: #28a745;
            background: #f8fff8;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(40,167,69,0.2);
        }
        
        .suspect-name {
            font-weight: 700;
            font-size: 1.2em;
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .suspect-info p {
            margin: 8px 0;
            color: #6c757d;
            font-size: 0.95em;
        }
        
        .suspect-info strong {
            color: #495057;
        }
        
        .selected-suspect {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #155724;
            font-weight: 600;
        }
        
        .sharing-board {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border-left: 5px solid #17a2b8;
        }
        
        .sharing-board h3 {
            color: #17a2b8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .student-response {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .student-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .student-answer {
            color: #6c757d;
            line-height: 1.6;
            font-style: italic;
        }
        
        .share-input {
            background: white;
            border: 2px solid #17a2b8;
            border-radius: 8px;
            padding: 12px 15px;
            width: 100%;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .share-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            background: #138496;
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            .witness-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div class="header">
            <h1>ğŸ•µï¸ Who Threw a Cake at the Monalisa? ğŸ‚</h1>
            <div class="stage-indicator">
                ëª©ê²©ì <span id="current-stage">1</span> / 4
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 25%"></div>
            </div>
        </div>

<div id="auth-buttons" style="
    display: flex; 
    align-items: center; 
    gap: 12px;
    position: absolute; 
    top: 6px; 
    right: 12px;
    background: rgba(255,255,255,0.65);
    backdrop-filter: blur(10px);
    border-radius: 18px;
    padding: 4px 12px 4px 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    font-family: 'Noto Sans KR', sans-serif;
    z-index: 1;
">
  <span id="user-info" style="
      color: #1976d2; 
      font-weight: 600;
      font-size: 1em;
      letter-spacing: 0.5px;
      margin-right: 4px;
      transition: color 0.2s;">
  </span>
  <button id="login-btn" onclick="signInWithGoogle()" style="
    background: linear-gradient(45deg, #28a745, #20c997);
    color: white;
    border: none;
    padding: 7px 18px;
    border-radius: 16px;
    font-size: 0.97em;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(40,167,69,0.12);
    transition: background 0.2s, transform 0.2s;
    outline: none;
    font-family: inherit;
  " onmouseover="this.style.background='linear-gradient(45deg,#20c997,#28a745)'" onmouseout="this.style.background='linear-gradient(45deg, #28a745, #20c997)'">
    êµ¬ê¸€ ë¡œê·¸ì¸
  </button>
  <button id="logout-btn" onclick="signOut()" style="
    display:none;
    background: linear-gradient(45deg, #ff6b6b, #ffa500);
    color: white;
    border: none;
    padding: 7px 18px;
    border-radius: 16px;
    font-size: 0.97em;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(255,107,107,0.11);
    transition: background 0.2s, transform 0.2s;
    outline: none;
    font-family: inherit;
  " onmouseover="this.style.background='linear-gradient(45deg,#ffa500,#ff6b6b)'" onmouseout="this.style.background='linear-gradient(45deg, #ff6b6b, #ffa500)'">
    ë¡œê·¸ì•„ì›ƒ
  </button>
</div>
        
        <div class="content">
            <!-- Introduction Stage -->
            <div class="stage active" id="stage-intro">
                <div class="story-section">
                    <h2>ğŸ¨ Fun Fact</h2>
                    <p><strong>'Monalisa'</strong>ëŠ” ì½œë¡¬ë¹„ì•„ í™”ê°€ Fernando Boteroì˜ ê·¸ë¦¼ìœ¼ë¡œ, Leonardo da Vinciì˜ 'Mona Lisa'ë¥¼ íŒ¨ëŸ¬ë””í•œ ì‘í’ˆì´ì—ìš”.</p>
                </div>
                
                <div class="english-text" id="intro-text">
                    <p><strong>Last Saturday, someone <span class="highlightable" data-word="threw">threw</span> a cake at the Monalisa in the Botero <span class="highlightable" data-word="museum">Museum</span> in Bogota, Colombia. There were four <span class="highlightable" data-word="eyewitness">eyewitnesses</span>. What did they say? Read the <span class="highlightable" data-word="following">following</span>, and find the <span class="highlightable" data-word="criminal">criminal</span>.</strong></p>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word" onclick="highlightWord('threw')">threw (ë˜ì¡Œë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('eyewitness')">eyewitness (ëª©ê²©ì)</span>
                        <span class="vocab-word" onclick="highlightWord('criminal')">criminal (ë²”ì¸)</span>
                        <span class="vocab-word" onclick="highlightWord('following')">following (ë‹¤ìŒì˜)</span>
                        <span class="vocab-word" onclick="highlightWord('museum')">museum (ë°•ë¬¼ê´€)</span>
                    </div>
                </div>
                
                <div class="question-section">
                    <div class="question">
                        <span class="question-number">Q0</span>
                        Where did the incident happen? (ì‚¬ê±´ì´ ì–´ë””ì„œ ì¼ì–´ë‚¬ë‚˜ìš”?)
                    </div>
                    <input type="text" class="answer-input" id="answer-intro" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                    <div id="feedback-intro" class="feedback" style="display: none;"></div>
                </div>
                
                <button class="submit-btn" onclick="checkIntroAnswer()" id="submit-intro">ë‹µì•ˆ í™•ì¸í•˜ê¸°</button>
            </div>
            
            <!-- Stage 1: Ann Jones -->
            <div class="stage" id="stage-1">
                <div class="witness-card">
                    <div class="witness-name">ğŸ‘© Ann Jones</div>
                    <div class="witness-role">a visitor (ê´€ëŒê°)</div>
                </div>
                
                <div class="english-text" id="ann-text">
                    <p><em>"I was looking at the Monalisa, and someone threw a cake at the <span class="highlightable" data-word="painting">painting</span>. I <span class="highlightable" data-word="turned around">turned around</span> and saw an old man. He was standing <span class="highlightable" data-word="in front of">in front of</span> a <span class="highlightable" data-word="wheelchair">wheelchair</span>. I'm about 170 cm tall, and he was a little <span class="highlightable" data-word="taller">taller</span> than me."</em></p>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word" onclick="highlightWord('painting')">painting (ê·¸ë¦¼)</span>
                        <span class="vocab-word" onclick="highlightWord('turned around')">turned around (ëŒì•„ë´¤ë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('wheelchair')">wheelchair (íœ ì²´ì–´)</span>
                        <span class="vocab-word" onclick="highlightWord('taller')">taller (ë” í‚¤ê°€ í°)</span>
                        <span class="vocab-word" onclick="highlightWord('in front of')">in front of (~ì•ì—)</span>
                    </div>
                </div>
                
                <div class="questions-container">
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q1</span>
                            What was Ann doing when the incident happened? (ì‚¬ê±´ì´ ì¼ì–´ë‚¬ì„ ë•Œ Annì€ ë¬´ì—‡ì„ í•˜ê³  ìˆì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-1-1" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-1-1" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q2</span>
                            How tall was the old man compared to Ann? (ê·¸ ë…¸ì¸ì€ Annê³¼ ë¹„êµí•´ì„œ í‚¤ê°€ ì–´ë• ë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-1-2" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-1-2" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q3</span>
                            Where was the old man standing? (ê·¸ ë…¸ì¸ì€ ì–´ë””ì— ì„œ ìˆì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-1-3" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-1-3" class="feedback" style="display: none;"></div>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="checkStageAnswers(1)" id="submit-1">ë‹µì•ˆ í™•ì¸í•˜ê¸°</button>
            </div>
            
            <!-- Stage 2: Carlos Diaz -->
            <div class="stage" id="stage-2">
                <div class="witness-card">
                    <div class="witness-name">ğŸ§¹ Carlos Diaz</div>
                    <div class="witness-role">a janitor (ì²­ì†Œë¶€)</div>
                </div>
                
                <div class="english-text" id="carlos-text">
                    <p><em>"An old man with gray hair was <span class="highlightable" data-word="running away">running away</span>, and something <span class="highlightable" data-word="fell off">fell off</span> his head. It was his <span class="highlightable" data-word="wig">wig</span>. I ran after him, but I couldn't <span class="highlightable" data-word="catch">catch</span> him. He was faster than me. <span class="highlightable" data-word="in fact">In fact</span>, the old man was not old. He was a young man with long brown hair."</em></p>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word" onclick="highlightWord('running away')">running away (ë„ë§ê°€ëŠ”)</span>
                        <span class="vocab-word" onclick="highlightWord('fell off')">fell off (ë–¨ì–´ì¡Œë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('wig')">wig (ê°€ë°œ)</span>
                        <span class="vocab-word" onclick="highlightWord('catch')">catch (ì¡ë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('in fact')">in fact (ì‚¬ì‹¤ì€)</span>
                    </div>
                </div>
                
                <div class="questions-container">
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q4</span>
                            What fell off the old man's head? (ê·¸ ë…¸ì¸ì˜ ë¨¸ë¦¬ì—ì„œ ë¬´ì—‡ì´ ë–¨ì–´ì¡Œë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-2-1" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-2-1" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q5</span>
                            Why couldn't Carlos catch the man? (CarlosëŠ” ì™œ ê·¸ ë‚¨ìë¥¼ ì¡ì„ ìˆ˜ ì—†ì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-2-2" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-2-2" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q6</span>
                            What color was the young man's real hair? (ê·¸ ì Šì€ ë‚¨ìì˜ ì§„ì§œ ë¨¸ë¦¬ìƒ‰ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-2-3" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-2-3" class="feedback" style="display: none;"></div>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="checkStageAnswers(2)" id="submit-2">ë‹µì•ˆ í™•ì¸í•˜ê¸°</button>
            </div>
            
            <!-- Stage 3: Diego Perez -->
            <div class="stage" id="stage-3">
                <div class="witness-card">
                    <div class="witness-name">ğŸ‘® Diego Perez</div>
                    <div class="witness-role">a guard (ê²½ë¹„ì›)</div>
                </div>
                
                <div class="english-text" id="diego-text">
                    <p><em>"I went to the <span class="highlightable" data-word="crime scene">crime scene</span>, and there were <span class="highlightable" data-word="pieces">pieces</span> of cake <span class="highlightable" data-word="all over">all over</span> the painting. There was also a wheelchair near the painting, and I found a cake box <span class="highlightable" data-word="next to">next to</span> the wheelchair. The box was from Camila's <span class="highlightable" data-word="bakery">Bakery</span>."</em></p>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word" onclick="highlightWord('crime scene')">crime scene (ë²”ì£„ í˜„ì¥)</span>
                        <span class="vocab-word" onclick="highlightWord('pieces')">pieces (ì¡°ê°ë“¤)</span>
                        <span class="vocab-word" onclick="highlightWord('all over')">all over (~ì „ì²´ì—)</span>
                        <span class="vocab-word" onclick="highlightWord('next to')">next to (~ì˜†ì—)</span>
                        <span class="vocab-word" onclick="highlightWord('bakery')">bakery (ë¹µì§‘)</span>
                    </div>
                </div>
                
                <div class="questions-container">
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q7</span>
                            What did Diego find all over the painting? (DiegoëŠ” ê·¸ë¦¼ ì „ì²´ì—ì„œ ë¬´ì—‡ì„ ë°œê²¬í–ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-3-1" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-3-1" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q8</span>
                            What did Diego find next to the wheelchair? (DiegoëŠ” íœ ì²´ì–´ ì˜†ì—ì„œ ë¬´ì—‡ì„ ë°œê²¬í–ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-3-2" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-3-2" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q9</span>
                            Where was the cake box from? (ì¼€ì´í¬ ìƒìëŠ” ì–´ë””ì„œ ì˜¨ ê²ƒì´ì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-3-3" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-3-3" class="feedback" style="display: none;"></div>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="checkStageAnswers(3)" id="submit-3">ë‹µì•ˆ í™•ì¸í•˜ê¸°</button>
            </div>
            
            <!-- Stage 4: Camila Santos -->
            <div class="stage" id="stage-4">
                <div class="witness-card">
                    <div class="witness-name">ğŸ§ Camila Santos</div>
                    <div class="witness-role">the owner of Camila's Bakery (ë² ì´ì»¤ë¦¬ ì‚¬ì¥)</div>
                </div>
                
                <div class="english-text" id="camila-text">
                    <p><em>"Last Friday, a young man <span class="highlightable" data-word="came in">came in</span>. I spoke to him in Spanish, but he didn't <span class="highlightable" data-word="understand">understand</span> me. He spoke only English. We had a lot of <span class="highlightable" data-word="different">different</span> cakes, but he just wanted the <span class="highlightable" data-word="smallest">smallest</span> one. We sold only one cake that day, so I remember him <span class="highlightable" data-word="clearly">clearly</span>. Oh, he had blue eyes."</em></p>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word" onclick="highlightWord('came in')">came in (ë“¤ì–´ì™”ë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('understand')">understand (ì´í•´í•˜ë‹¤)</span>
                        <span class="vocab-word" onclick="highlightWord('different')">different (ë‹¤ë¥¸)</span>
                        <span class="vocab-word" onclick="highlightWord('smallest')">smallest (ê°€ì¥ ì‘ì€)</span>
                        <span class="vocab-word" onclick="highlightWord('clearly')">clearly (ëª…í™•íˆ)</span>
                    </div>
                </div>
                
                <div class="questions-container">
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q10</span>
                            What language did the young man speak? (ê·¸ ì Šì€ ë‚¨ìëŠ” ì–´ë–¤ ì–¸ì–´ë¥¼ ë§í–ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-4-1" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-4-1" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q11</span>
                            Why does Camila remember the man clearly? (CamilaëŠ” ì™œ ê·¸ ë‚¨ìë¥¼ ëª…í™•íˆ ê¸°ì–µí•˜ë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-4-2" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-4-2" class="feedback" style="display: none;"></div>
                    </div>
                    
                    <div class="question-section">
                        <div class="question">
                            <span class="question-number">Q12</span>
                            What color were the man's eyes? (ê·¸ ë‚¨ìì˜ ëˆˆì€ ë¬´ìŠ¨ ìƒ‰ì´ì—ˆë‚˜ìš”?)
                        </div>
                        <input type="text" class="answer-input" id="answer-4-3" placeholder="ì˜ì–´ë¡œ ë‹µí•˜ì„¸ìš”">
                        <div id="feedback-4-3" class="feedback" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="story-section" style="margin-top: 30px;">
                    <h3>ğŸ¤” Think!</h3>
                    <p><strong>Why did the man want the smallest cake? Can you guess?</strong></p>
                    <p style="margin-top: 15px; font-style: italic; color: #6c757d;">
                        ğŸ’¡ ì´ ì´ì•¼ê¸°ëŠ” 2022ë…„ 5ì›”, í•œ ë‚¨ìê°€ íŒŒë¦¬ì˜ ë£¨ë¸Œë¥´ ë°•ë¬¼ê´€ì—ì„œ Leonardo da Vinciì˜ 'Mona Lisa' ê·¸ë¦¼ì„ ì¼€ì´í¬ë¡œ í›¼ì†í•œ ì‹¤ì œ ì‚¬ê±´ì„ ê°ìƒ‰í•œ ê²ƒì…ë‹ˆë‹¤.
                    </p>
                </div>
                
                <button class="submit-btn" onclick="checkStageAnswers(4)" id="submit-4">ë‹µì•ˆ í™•ì¸í•˜ê¸°</button>
            </div>
            
            <!-- Stage 5: Find the Criminal -->
            <div class="stage" id="stage-5">
                <div class="story-section">
                    <h2>ğŸ” Now, look at the information about the suspects.</h2>
                    <p><strong>Who threw the cake at the Monalisa?</strong></p>
                </div>
                
                <div class="suspects-container">
                    <div class="suspect-card" onclick="selectSuspect('andres')">
                        <div class="suspect-name">Andres Lozano</div>
                        <div class="suspect-info">
                            <p><strong>Height:</strong> 176 cm</p>
                            <p><strong>Hair:</strong> long, black</p>
                            <p><strong>Languages:</strong> Spanish, English</p>
                            <p><strong>Eyes:</strong> brown</p>
                        </div>
                    </div>
                    
                    <div class="suspect-card" onclick="selectSuspect('larry')">
                        <div class="suspect-name">Larry Johnson</div>
                        <div class="suspect-info">
                            <p><strong>Height:</strong> 173 cm</p>
                            <p><strong>Hair:</strong> long, brown</p>
                            <p><strong>Languages:</strong> English</p>
                            <p><strong>Eyes:</strong> blue</p>
                        </div>
                    </div>
                    
                    <div class="suspect-card" onclick="selectSuspect('tim')">
                        <div class="suspect-name">Tim Baker</div>
                        <div class="suspect-info">
                            <p><strong>Height:</strong> 182 cm</p>
                            <p><strong>Hair:</strong> long, brown</p>
                            <p><strong>Languages:</strong> English</p>
                            <p><strong>Eyes:</strong> green</p>
                        </div>
                    </div>
                    
                    <div class="suspect-card" onclick="selectSuspect('luca')">
                        <div class="suspect-name">Luca Ferez</div>
                        <div class="suspect-info">
                            <p><strong>Height:</strong> 166 cm</p>
                            <p><strong>Hair:</strong> short, gray</p>
                            <p><strong>Languages:</strong> Spanish</p>
                            <p><strong>Eyes:</strong> blue</p>
                        </div>
                    </div>
                </div>
                
                <div class="question-section">
                    <div class="question">
                        <span class="question-number">Final</span>
                        ë²”ì¸ì„ ì„ íƒí•˜ê³ , ê·¸ ì´ìœ ë¥¼ ì˜ì–´ë¡œ ì„¤ëª…í•˜ì„¸ìš”. (Choose the criminal and explain why in English.)
                    </div>
                    <div class="selected-suspect" id="selected-suspect" style="display: none;">
                        <p>ì„ íƒí•œ ìš©ì˜ì: <span id="suspect-name"></span></p>
                    </div>
                    <textarea class="answer-input" id="criminal-reason" placeholder="Why do you think this person is the criminal? Explain in English..." rows="4"></textarea>
                    <div id="feedback-criminal" class="feedback" style="display: none;"></div>
                </div>
                
                <div class="vocabulary">
                    <h3>ğŸ“š Key Vocabulary</h3>
                    <div class="vocab-words">
                        <span class="vocab-word">suspect (ìš©ì˜ì)</span>
                        <span class="vocab-word">height (í‚¤)</span>
                        <span class="vocab-word">evidence (ì¦ê±°)</span>
                        <span class="vocab-word">clue (ë‹¨ì„œ)</span>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="checkCriminal()" id="submit-criminal" disabled>ë²”ì¸ í™•ì •í•˜ê¸°</button>
            </div>
            
            <!-- Sharing Board Stage -->
            <div class="stage" id="stage-sharing">
                <div class="sharing-board">
                    <h3>ğŸ’¬ í•™ìƒë“¤ì˜ ì¶”ë¡  ê³µìœ  ê²Œì‹œíŒ</h3>
                    <p style="color: #6c757d; margin-bottom: 20px;">ë‹¤ë¥¸ í•™ìƒë“¤ì˜ ì¶”ë¡ ì„ ë³´ê³  ì—¬ëŸ¬ë¶„ì˜ ìƒê°ë„ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                    
                    <div class="student-response sample">
                        <div class="student-name">ğŸ‘¤ Student A <span style="color: #6c757d; font-size: 0.8em; font-weight: normal;">ìƒ˜í”Œ</span></div>
                        <div class="student-answer">"Andres Lozano is the criminal because he has brown eyes and speaks Spanish and English. His height (176cm) is a little taller than Ann (170cm). He also has long black hair."</div>
                    </div>
                    
                    <div class="student-response sample">
                        <div class="student-name">ğŸ‘¤ Student B <span style="color: #6c757d; font-size: 0.8em; font-weight: normal;">ìƒ˜í”Œ</span></div>
                        <div class="student-answer">"I think it's Tim Baker. The evidence shows: green eyes (Camila saw), English only (couldn't understand Spanish), brown hair (Carlos found the wig), and he's taller than Ann."</div>
                    </div>

                    
                    <div id="new-responses"></div>
                    
                    <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                        <h4 style="color: #17a2b8; margin-bottom: 10px;">âœï¸ ì—¬ëŸ¬ë¶„ì˜ ì¶”ë¡ ì„ ê³µìœ í•´ì£¼ì„¸ìš”!</h4>
                        <input type="text" class="share-input" id="student-name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
                        <textarea class="share-input" id="student-reasoning" placeholder="ë²”ì¸ì„ ì°¾ì€ ê³¼ì •ê³¼ ì´ìœ ë¥¼ ì˜ì–´ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”..." rows="3"></textarea>
                        <button class="share-btn" onclick="shareReasoning()">ê³µìœ í•˜ê¸° ğŸ“¤</button>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="showFinalStage()" style="max-width: 300px; margin: 20px auto 0;">
                    ğŸ‰ ìµœì¢… ê²°ê³¼ ë³´ê¸°
                </button>
            </div>
            
            <!-- Final Stage: Success -->
            <div class="stage final-stage" id="stage-final">
                <div class="celebration">ğŸ‰ğŸ•µï¸â€â™€ï¸ğŸ‚</div>
                <h2>Case Solved!</h2>
                <div class="score-display">
                    <h3>ğŸ“Š ìµœì¢… ì ìˆ˜</h3>
                    <p style="font-size: 1.5em; color: #28a745; font-weight: bold;">
                        <span id="final-score">0</span> / 14 ë¬¸ì œ ì •ë‹µ
                    </p>
                    <p style="margin-top: 10px; color: #6c757d;">
                        ì •ë‹µë¥ : <span id="accuracy">0</span>%
                    </p>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #495057; margin-bottom: 15px;">ğŸ” Case Summary</h3>
                    <p style="text-align: left; line-height: 1.8;">
                        ë²”ì¸ì€ <strong>ê¸´ ê°ˆìƒ‰ ë¨¸ë¦¬ì— íŒŒë€ ëˆˆì„ ê°€ì§„ ì Šì€ ë‚¨ì</strong>ì˜€ìŠµë‹ˆë‹¤. 
                        ê·¸ëŠ” íšŒìƒ‰ ê°€ë°œì„ ì¨ì„œ ë…¸ì¸ìœ¼ë¡œ ë³€ì¥í–ˆê³ , íœ ì²´ì–´ë¥¼ ì´ìš©í•´ ë°•ë¬¼ê´€ì— ë“¤ì–´ê°”ì–´ìš”. 
                        ì˜ì–´ë§Œ í•  ìˆ˜ ìˆì—ˆê³ , ì¹´ë°€ë¼ ë² ì´ì»¤ë¦¬ì—ì„œ ê°€ì¥ ì‘ì€ ì¼€ì´í¬ë¥¼ ìƒ€ìŠµë‹ˆë‹¤. 
                        ê°€ì¥ ì‘ì€ ì¼€ì´í¬ë¥¼ ì‚° ì´ìœ ëŠ” ë˜ì§€ê¸° ì‰½ê³  ìˆ¨ê¸°ê¸° ì‰¬ì› ê¸° ë•Œë¬¸ì¼ ê±°ì˜ˆìš”!
                    </p>
                </div>
                
                <button class="submit-btn" onclick="restartGame()" style="max-width: 300px; margin: 0 auto;">
                    ğŸ”„ ë‹¤ì‹œ ë„ì „í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-database-compat.js"></script>
         <!-- ğŸ”‘ Firebase Auth SDK ì¶”ê°€ -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-auth-compat.js"></script>
    
    
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBFq-99bZSsy3h1qNy7irJZe7Z0OpZ9s4k",
            authDomain: "st-grade-9e67f.firebaseapp.com",
            databaseURL: "https://st-grade-9e67f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "st-grade-9e67f",
            storageBucket: "st-grade-9e67f.firebasestorage.app",
            messagingSenderId: "481985157615",
            appId: "1:481985157615:web:a40a8623938815ad283e1a"
        };
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const reasoningsRef = database.ref('student-reasonings');

                // ğŸ”‘ êµ¬ê¸€ ë¡œê·¸ì¸ í•¨ìˆ˜
        function signInWithGoogle() {
          var provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().signInWithPopup(provider)
            .catch(function(error) {
              alert("ë¡œê·¸ì¸ ì˜¤ë¥˜: " + error.message);
            });
        }
        // ğŸ”‘ ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function signOut() {
          firebase.auth().signOut();
        }
        // ğŸ”‘ ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ì‹œ UI/ê³µìœ ë²„íŠ¼ ì²˜ë¦¬
        firebase.auth().onAuthStateChanged(function(user) {
          const loginBtn = document.getElementById('login-btn');
          const logoutBtn = document.getElementById('logout-btn');
          const userInfo = document.getElementById('user-info');
          if (user) {
            loginBtn.style.display = "none";
            logoutBtn.style.display = "";
            userInfo.textContent = user.displayName + "ë‹˜";
            document.querySelectorAll('.share-btn').forEach(btn => btn.disabled = false);
          } else {
            loginBtn.style.display = "";
            logoutBtn.style.display = "none";
            userInfo.textContent = "";
            document.querySelectorAll('.share-btn').forEach(btn => btn.disabled = true);
          }
        });
        // ğŸ”‘ ìµœì´ˆ ë¡œë”© ì‹œ ê³µìœ ë²„íŠ¼ ë¹„í™œì„±í™”
        document.addEventListener('DOMContentLoaded', function() {
          document.querySelectorAll('.share-btn').forEach(btn => btn.disabled = true);
        });
        
        let currentStage = 0;
        const totalStages = 5;
        let correctAnswers = 0;
        let stageScores = [0, 0, 0, 0, 0];
        let selectedSuspect = null;
        
        const answers = {
            1: {
                1: ["looking at the monalisa", "looking at the painting", "she was looking at the monalisa", "watching the monalisa", "looking at monalisa"],
                2: ["a little taller", "taller", "he was a little taller", "little taller than her", "little taller", "taller than ann"],
                3: ["in front of a wheelchair", "standing in front of a wheelchair", "front of a wheelchair", "before a wheelchair", "front of wheelchair"]
            },
            2: {
                1: ["wig", "his wig", "a wig", "the wig"],
                2: ["he was faster", "faster than carlos", "he was faster than me", "the man was faster", "faster", "he was faster than carlos"],
                3: ["brown", "long brown hair", "brown hair", "long brown", "long brown hair"]
            },
            3: {
                1: ["pieces of cake", "cake pieces", "pieces", "cake", "pieces of cake"],
                2: ["cake box", "a cake box", "box", "the cake box"],
                3: ["camila's bakery", "camila bakery", "from camila's bakery", "camilas bakery", "camila's", "camila"]
            },
            4: {
                1: ["english", "only english", "he spoke english", "spoke only english", "he spoke only english"],
                2: ["they sold only one cake", "sold only one cake", "only one cake that day", "one cake", "sold only one cake that day"],
                3: ["blue", "blue eyes", "his eyes were blue", "they were blue"]
            }
        };
        
        function highlightWord(word) {
            // Remove previous highlights
            document.querySelectorAll('.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            // Find and highlight the word
            const highlightableElements = document.querySelectorAll('.highlightable');
            highlightableElements.forEach(el => {
                if (el.dataset.word === word) {
                    el.classList.add('highlighted');
                }
            });
            
            // Remove highlight after 3 seconds
            setTimeout(() => {
                document.querySelectorAll('.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                });
            }, 3000);
        }
        
        function checkIntroAnswer() {
            const input = document.getElementById('answer-intro');
            const feedback = document.getElementById('feedback-intro');
            const userAnswer = input.value.toLowerCase().trim();
            
            const correctAnswers = ["botero museum", "the botero museum", "museum", "botero museum in bogota", "in the botero museum"];
            
            let isCorrect = false;
            for (let correctAnswer of correctAnswers) {
                if (userAnswer === correctAnswer.toLowerCase() || 
                    (userAnswer.length > 3 && correctAnswer.toLowerCase().includes(userAnswer)) ||
                    (correctAnswer.length > 3 && userAnswer.includes(correctAnswer.toLowerCase()))) {
                    isCorrect = true;
                    break;
                }
            }
            
            feedback.style.display = 'block';
            
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = 'âœ… ì •ë‹µì…ë‹ˆë‹¤! ì´ì œ ëª©ê²©ìë“¤ì˜ ì¦ì–¸ì„ ë“¤ì–´ë³´ì„¸ìš”.';
                input.style.borderColor = '#28a745';
                
                document.getElementById('submit-intro').disabled = true;
                document.getElementById('submit-intro').innerHTML = 'ì •ë‹µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™ ì¤‘...';
                
                setTimeout(() => {
                    nextStage();
                }, 2000);
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = 'âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ì§€ë¬¸ì„ ìì„¸íˆ ì½ì–´ë³´ì„¸ìš”!';
                input.style.borderColor = '#dc3545';
            }
        }
        
        function nextStage() {
            if (currentStage === 0) {
                document.getElementById('stage-intro').classList.remove('active');
                currentStage = 1;
                document.getElementById('stage-1').classList.add('active');
                updateProgress();
            }
        }
        
        function checkStageAnswers(stage) {
            let stageCorrect = 0;
            let allCorrect = true;
            
            for (let q = 1; q <= 3; q++) {
                const input = document.getElementById(`answer-${stage}-${q}`);
                const feedback = document.getElementById(`feedback-${stage}-${q}`);
                const userAnswer = input.value.toLowerCase().trim();
                
                let isCorrect = false;
                
                if (answers[stage] && answers[stage][q]) {
                    for (let correctAnswer of answers[stage][q]) {
                        if (userAnswer === correctAnswer.toLowerCase() || 
                            (userAnswer.length > 3 && correctAnswer.toLowerCase().includes(userAnswer)) ||
                            (correctAnswer.length > 3 && userAnswer.includes(correctAnswer.toLowerCase()))) {
                            isCorrect = true;
                            break;
                        }
                    }
                }
                
                feedback.style.display = 'block';
                
                if (isCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'âœ… ì •ë‹µì…ë‹ˆë‹¤!';
                    stageCorrect++;
                    input.style.borderColor = '#28a745';
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = 'âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ì§€ë¬¸ì„ ìì„¸íˆ ì½ì–´ë³´ì„¸ìš”!';
                    input.style.borderColor = '#dc3545';
                    allCorrect = false;
                }
            }
            
            stageScores[stage - 1] = stageCorrect;
            correctAnswers = stageScores.reduce((a, b) => a + b, 0);
            
            // Only proceed if all answers are correct
            if (allCorrect) {
                document.getElementById(`submit-${stage}`).disabled = true;
                document.getElementById(`submit-${stage}`).innerHTML = `3/3 ì •ë‹µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™ ì¤‘...`;
                
                setTimeout(() => {
                    if (stage < 4) {
                        moveToNextStage(stage);
                    } else {
                        moveToSuspectStage();
                    }
                }, 2000);
            } else {
                document.getElementById(`submit-${stage}`).innerHTML = `${stageCorrect}/3 ì •ë‹µ - ëª¨ë“  ë¬¸ì œë¥¼ ë§í˜€ì•¼ í•©ë‹ˆë‹¤!`;
                
                // Re-enable button after 3 seconds
                setTimeout(() => {
                    document.getElementById(`submit-${stage}`).innerHTML = 'ë‹µì•ˆ í™•ì¸í•˜ê¸°';
                }, 3000);
            }
        }
        
        function moveToNextStage(currentStageNum) {
            document.getElementById(`stage-${currentStageNum}`).classList.remove('active');
            currentStage = currentStageNum + 1;
            document.getElementById(`stage-${currentStage}`).classList.add('active');
            updateProgress();
        }
        
        function moveToSuspectStage() {
            document.getElementById('stage-4').classList.remove('active');
            currentStage = 5;
            document.getElementById('stage-5').classList.add('active');
            updateProgress();
        }
        
        function updateProgress() {
            document.getElementById('current-stage').textContent = currentStage === 5 ? 'ë²”ì¸ì°¾ê¸°' : currentStage;
            const progress = (currentStage / totalStages) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        function selectSuspect(suspect) {
            // Remove previous selection
            document.querySelectorAll('.suspect-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.target.closest('.suspect-card').classList.add('selected');
            
            selectedSuspect = suspect;
            
            // Show selected suspect info
            const suspectNames = {
                'andres': 'Andres Lozano',
                'larry': 'Larry Johnson', 
                'tim': 'Tim Baker',
                'luca': 'Luca Ferez'
            };
            
            document.getElementById('selected-suspect').style.display = 'block';
            document.getElementById('suspect-name').textContent = suspectNames[suspect];
            
            // Enable submit button
            document.getElementById('submit-criminal').disabled = false;
        }
        
        function checkCriminal() {
            const reasonInput = document.getElementById('criminal-reason');
            const feedback = document.getElementById('feedback-criminal');
            const reason = reasonInput.value.toLowerCase().trim();
            
            feedback.style.display = 'block';
            
            // Check if Larry Johnson is selected (correct answer)
            if (selectedSuspect === 'larry') {
                // Check if reason mentions key evidence
                const hasValidReason = reason.includes('blue eyes') || 
                                     reason.includes('english') || 
                                     reason.includes('brown hair') || 
                                     reason.includes('173') ||
                                     reason.includes('height') ||
                                     reason.includes('tall');
                
                if (hasValidReason && reason.length > 10) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! Larry Johnsonì´ ë²”ì¸ì´ ë§ìŠµë‹ˆë‹¤!';
                    stageScores[4] = 1;
                    correctAnswers = stageScores.reduce((a, b) => a + b, 0);
                    
                    document.getElementById('submit-criminal').disabled = true;
                    document.getElementById('submit-criminal').innerHTML = 'ë²”ì¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤! ê³µìœ  ê²Œì‹œíŒìœ¼ë¡œ ì´ë™ ì¤‘...';
                    
                    setTimeout(() => {
                        showSharingBoard();
                    }, 3000);
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = 'âŒ ì˜¬ë°”ë¥¸ ìš©ì˜ìë¥¼ ì„ íƒí–ˆì§€ë§Œ, ì¦ê±°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë” ìì„¸í•œ ì´ìœ ë¥¼ ì˜ì–´ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”!';
                }
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = 'âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! ëª©ê²©ìë“¤ì˜ ì¦ì–¸ì„ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”. í‚¤, ë¨¸ë¦¬ìƒ‰, ëˆˆìƒ‰, ì–¸ì–´ ë“±ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.';
            }
        }
        
        function showSharingBoard() {
            document.getElementById('stage-5').classList.remove('active');
            document.getElementById('stage-sharing').classList.add('active');
            
            // Update progress
            document.getElementById('current-stage').textContent = 'ê³µìœ ';
            document.getElementById('progress-fill').style.width = '90%';
            
            // Firebaseì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í•™ìƒ ì¶”ë¡  ë¶ˆëŸ¬ì˜¤ê¸°
            loadStudentReasonings();
        }
        
        function loadStudentReasonings() {
            // ê¸°ì¡´ ìƒ˜í”Œ ë°ì´í„° ì œê±°
            const existingResponses = document.querySelectorAll('.student-response');
            existingResponses.forEach(response => {
                if (!response.classList.contains('sample')) {
                    response.remove();
                }
            });
            
            // Firebaseì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë‹
            reasoningsRef.orderByChild('timestamp').on('value', (snapshot) => {
                const newResponsesContainer = document.getElementById('new-responses');
                newResponsesContainer.innerHTML = ''; // ê¸°ì¡´ ë°ì´í„° í´ë¦¬ì–´
                
                if (snapshot.exists()) {
                    const reasonings = [];
                    snapshot.forEach((childSnapshot) => {
                        reasonings.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });
                    
                    // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬
                    reasonings.sort((a, b) => b.timestamp - a.timestamp);
                    
                    // ê° ì¶”ë¡ ì„ í™”ë©´ì— í‘œì‹œ
                    reasonings.forEach((reasoning) => {
                        const responseElement = document.createElement('div');
                        responseElement.className = 'student-response';
                        responseElement.style.animation = 'fadeIn 0.5s ease-in';
                        
                        const timeAgo = getTimeAgo(reasoning.timestamp);
                        
                        responseElement.innerHTML = `
                            <div class="student-name">ğŸ‘¤ ${reasoning.name} <span style="color: #6c757d; font-size: 0.8em; font-weight: normal;">${timeAgo}</span></div>
                            <div class="student-answer">"${reasoning.reasoning}"</div>
                        `;
                        
                        newResponsesContainer.appendChild(responseElement);
                    });
                }
            });
        }
        
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return `${minutes}ë¶„ ì „`;
            if (hours < 24) return `${hours}ì‹œê°„ ì „`;
            return `${days}ì¼ ì „`;
        }
        
        function shareReasoning() {
            const nameInput = document.getElementById('student-name-input');
            const reasoningInput = document.getElementById('student-reasoning');
            const shareBtn = document.querySelector('.share-btn');
            const name = nameInput.value.trim();
            const reasoning = reasoningInput.value.trim();
            
            if (name && reasoning && reasoning.length > 10) {
                // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
                shareBtn.disabled = true;
                shareBtn.innerHTML = 'ê³µìœ  ì¤‘... â³';
                
                // Firebaseì— ë°ì´í„° ì €ì¥
                const newReasoningRef = reasoningsRef.push();
                const reasoningData = {
                    name: name,
                    reasoning: reasoning,
                    timestamp: Date.now(),
                    suspect: selectedSuspect || 'unknown'
                };
                
                newReasoningRef.set(reasoningData)
                    .then(() => {
                        // ì„±ê³µ ì‹œ
                        nameInput.value = '';
                        reasoningInput.value = '';
                        
                        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                        showSuccessMessage('ì¶”ë¡ ì´ ì„±ê³µì ìœ¼ë¡œ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
                        
                        // ë²„íŠ¼ ë³µì›
                        shareBtn.disabled = false;
                        shareBtn.innerHTML = 'ê³µìœ í•˜ê¸° ğŸ“¤';
                    })
                    .catch((error) => {
                        // ì˜¤ë¥˜ ì‹œ
                        console.error('Error sharing reasoning:', error);
                        showErrorMessage('ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        
                        // ë²„íŠ¼ ë³µì›
                        shareBtn.disabled = false;
                        shareBtn.innerHTML = 'ê³µìœ í•˜ê¸° ğŸ“¤';
                    });
            } else {
                showErrorMessage('ì´ë¦„ê³¼ ì¶”ë¡  ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì¶”ë¡ ì€ 10ì ì´ìƒ)');
            }
        }
        
        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #d4edda;
                color: #155724;
                padding: 15px 20px;
                border-radius: 8px;
                border: 1px solid #c3e6cb;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            messageDiv.innerHTML = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 300);
            }, 3000);
        }
        
        function showErrorMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #f8d7da;
                color: #721c24;
                padding: 15px 20px;
                border-radius: 8px;
                border: 1px solid #f5c6cb;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            messageDiv.innerHTML = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 300);
            }, 3000);
        }
        
        function showFinalStage() {
            document.getElementById('stage-sharing').classList.remove('active');
            document.getElementById('stage-final').classList.add('active');
            
            // Update final score (12 questions + 1 criminal identification)
            const totalScore = correctAnswers + (stageScores[4] || 0);
            document.getElementById('final-score').textContent = totalScore;
            const accuracy = Math.round((totalScore / 13) * 100);
            document.getElementById('accuracy').textContent = accuracy;
            
            // Update progress to 100%
            document.getElementById('progress-fill').style.width = '100%';
            document.getElementById('current-stage').textContent = 'ì™„ë£Œ';
        }
        
        function restartGame() {
            // Reset all variables
            currentStage = 0;
            correctAnswers = 0;
            stageScores = [0, 0, 0, 0, 0];
            selectedSuspect = null;
            
            // Reset all stages
            document.querySelectorAll('.stage').forEach(stage => {
                stage.classList.remove('active');
            });
            
            // Reset inputs and feedbacks
            document.querySelectorAll('.answer-input').forEach(input => {
                input.value = '';
                input.style.borderColor = '#dee2e6';
            });
            
            document.querySelectorAll('.feedback').forEach(feedback => {
                feedback.style.display = 'none';
            });
            
            // Reset suspect cards
            document.querySelectorAll('.suspect-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById('selected-suspect').style.display = 'none';
            
            // Clear shared responses
            document.getElementById('new-responses').innerHTML = '';
            
            // Firebase ë¦¬ìŠ¤ë„ˆ í•´ì œ
            if (reasoningsRef) {
                reasoningsRef.off();
            }
            
            // Reset submit buttons
            const introBtn = document.getElementById('submit-intro');
            if (introBtn) {
                introBtn.disabled = false;
                introBtn.innerHTML = 'ë‹µì•ˆ í™•ì¸í•˜ê¸°';
            }
            
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`submit-${i}`);
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = 'ë‹µì•ˆ í™•ì¸í•˜ê¸°';
                }
            }
            
            // Reset criminal submit button
            const criminalBtn = document.getElementById('submit-criminal');
            if (criminalBtn) {
                criminalBtn.disabled = true;
                criminalBtn.innerHTML = 'ë²”ì¸ í™•ì •í•˜ê¸°';
            }
            
            // Reset to intro stage
            document.getElementById('stage-intro').classList.add('active');
            document.getElementById('current-stage').textContent = '1';
            document.getElementById('progress-fill').style.width = '20%';
        }
        
        // Add enter key support for inputs
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.answer-input').forEach((input) => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        // Find which stage this input belongs to
                        const inputId = input.id;
                        const stageMatch = inputId.match(/answer-(\d+)-\d+/);
                        if (stageMatch) {
                            const stage = parseInt(stageMatch[1]);
                            const submitBtn = document.getElementById(`submit-${stage}`);
                            if (submitBtn && !submitBtn.disabled) {
                                checkStageAnswers(stage);
                            }
                        }
                    }
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ced57cf3f03121',t:'MTc1NzUwNjM1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<!-- ... ê¸°ì¡´ ì½”ë“œ ... -->

<!-- í˜ì´ì§€ ë§¨ ë§ˆì§€ë§‰ì— footer ì¶”ê°€! -->
<footer id="site-footer" style="
    width: 100%;
    text-align: center;
    padding: 18px 0 8px 0;
    font-size: 1.08em;
    color: #222;
    background: rgba(255,255,255,0.85);
    font-family: 'Noto Sans KR', sans-serif;
    letter-spacing: 0.7px;
">
  made by ê°•í•˜ì˜(ê°€íšŒì¤‘í•™êµ) â¤ï¸ Ask me if you have any questions
</footer>
</body>
</html>
